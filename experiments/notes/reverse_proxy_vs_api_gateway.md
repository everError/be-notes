# Reverse Proxy vs API Gateway

## κ°μ”

Reverse Proxyμ™€ API Gatewayλ” λ¨λ‘ ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ μ ν• λ°±μ—”λ“ μ„λ²„λ΅ μ „λ‹¬ν•λ” μ—­ν• μ„ ν•μ§€λ§, μ‚¬μ© λ©μ κ³Ό κΈ°λ¥μ΄ λ‹¤λ¦…λ‹λ‹¤. μ΄ λ¬Έμ„λ” λ‘ κ°λ…μ μ°¨μ΄μ μ„ λΉ„κµν•κ³ , μ–΄λ–¤ μƒν™©μ—μ„ μ–΄λ–¤ κΈ°μ μ„ μ‚¬μ©ν•΄μ•Ό ν•λ”μ§€ μ •λ¦¬ν•©λ‹λ‹¤.

---

## Reverse Proxy

### β… μ •μ

Reverse Proxyλ” **λ™μΌν• μ„λΉ„μ¤λ¥Ό μ κ³µν•λ” μ—¬λ¬ κ°μ μ„λ²„μ— ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ λ¶„μ‚°(λ΅λ“ λ°Έλ°μ‹±)ν•λ” ν”„λ΅μ‹ μ„λ²„**μ…λ‹λ‹¤.

### β… μ£Όμ” κΈ°λ¥

- **λ΅λ“ λ°Έλ°μ‹±**: ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ—¬λ¬ μ„λ²„λ΅ λ¶„λ°°ν•μ—¬ λ¶€ν•λ¥Ό μ¤„μ„.
- **SSL μ²λ¦¬**: HTTPS μ”μ²­μ„ μ²λ¦¬ν•κ³ , λ‚΄λ¶€ μ„λΉ„μ¤λ΅ HTTP μ”μ²­ μ „λ‹¬ κ°€λ¥.
- **μΊμ‹±**: μ •μ  μ½ν…μΈ λ¥Ό μΊμ‹±ν•μ—¬ μ‘λ‹µ μ†λ„ ν–¥μƒ.
- **λ³΄μ• κ°•ν™”**: λ‚΄λ¶€ μ„λ²„λ¥Ό μ§μ ‘ λ…Έμ¶ν•μ§€ μ•κ³ , μ”μ²­μ„ ν•„ν„°λ§ κ°€λ¥.

### β… μ‚¬μ© μ‚¬λ΅€

- **λ™μΌν• μ„λΉ„μ¤λ¥Ό μ κ³µν•λ” μ—¬λ¬ κ°μ μ„λ²„λ¥Ό μ΄μν•  λ•**
- **ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ λ¶€ν•κ°€ μ μ€ μ„λ²„λ΅ λ¶„μ‚°ν•κ³  μ‹¶μ„ λ•**
- **νΈλν”½μ΄ λ§μ€ μ„λΉ„μ¤μ—μ„ μ„±λ¥ μµμ ν™”κ°€ ν•„μ”ν•  λ•**

### π“ μμ 

#### π”Ή **Reverse Proxy μ—†μ΄ μ§μ ‘ μ”μ²­ν•λ” κ²½μ°**

```
ν΄λΌμ΄μ–ΈνΈ β†’ UserService(5001)
ν΄λΌμ΄μ–ΈνΈ β†’ UserService(5002)
ν΄λΌμ΄μ–ΈνΈ β†’ UserService(5003)
```

β΅οΈ ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„ μ£Όμ†λ¥Ό μ§μ ‘ μ•μ•„μ•Ό ν•λ©°, λ¶€ν• λ¶„μ‚°μ΄ μ–΄λ ¤μ›€.

#### π”Ή **Reverse Proxyλ¥Ό μ‚¬μ©ν•μ—¬ λ¶€ν• λ¶„μ‚°ν•λ” κ²½μ°**

```
ν΄λΌμ΄μ–ΈνΈ μ”μ²­ β†’ Reverse Proxy β†’ UserService(5001, 5002, 5003 μ¤‘ ν•λ‚λ΅ λ¶„μ‚°)
```

β΅οΈ ν΄λΌμ΄μ–ΈνΈλ” ν•λ‚μ μ—”λ“ν¬μΈνΈ(Reverse Proxy)λ§ μ‚¬μ©ν•λ©°, λ‚΄λ¶€μ μΌλ΅ λ¶€ν• λ¶„μ‚°μ΄ κ°€λ¥.

#### π”Ή **YARPλ¥Ό μ‚¬μ©ν• Reverse Proxy μμ ** (`Program.cs`)

```csharp
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddReverseProxy()
    .LoadFromMemory(new[]
    {
        new RouteConfig
        {
            RouteId = "user-service",
            ClusterId = "user-cluster",
            Match = new RouteMatch { Path = "/users/{**catch-all}" }
        }
    },
    new[]
    {
        new ClusterConfig
        {
            ClusterId = "user-cluster",
            Destinations = new Dictionary<string, DestinationConfig>
            {
                { "destination1", new DestinationConfig { Address = "http://userservice:5001" } },
                { "destination2", new DestinationConfig { Address = "http://userservice:5002" } }
            }
        }
    });

var app = builder.Build();
app.MapReverseProxy();
app.Run();
```

β΅οΈ ν΄λΌμ΄μ–ΈνΈκ°€ `/users/...` μ”μ²­μ„ λ³΄λ‚΄λ©΄ Reverse Proxyκ°€ `UserService(5001, 5002)`λ΅ μ”μ²­μ„ λ¶„μ‚°.

---

## API Gateway

### β… μ •μ

API Gatewayλ” **μ—¬λ¬ μΆ…λ¥μ λ‹¤λ¥Έ μ„λΉ„μ¤λ¥Ό μ΄μν•  λ•, ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ μ ν• μ„λΉ„μ¤λ΅ μ „λ‹¬ν•λ” μ—­ν• μ„ ν•λ” μ¤‘μ•™ κ΄€λ¦¬ ν¬μΈνΈ**μ…λ‹λ‹¤.

### β… μ£Όμ” κΈ°λ¥

- **λΌμ°ν…**: ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ¬λ°”λ¥Έ μ„λΉ„μ¤λ΅ μ „λ‹¬.
- **λ³΄μ• λ° μΈμ¦**: JWT, OAuth 2.0 λ“±μ„ ν™μ©ν• μΈμ¦/μΈκ°€.
- **Rate Limiting (μ†λ„ μ ν•)**: νΉμ • ν΄λΌμ΄μ–ΈνΈμ κ³Όλ„ν• μ”μ²­ λ°©μ§€.
- **μ”μ²­ λ³€ν™**: ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ λ‚΄λ¶€ μ„λΉ„μ¤κ°€ μ΄ν•΄ν•  μ μλ„λ΅ λ³€ν™.
- **λ΅κΉ… λ° λ¨λ‹ν„°λ§**: μ”μ²­ μ¶”μ  λ° μ„λΉ„μ¤ μƒνƒ λ¨λ‹ν„°λ§.

### β… μ‚¬μ© μ‚¬λ΅€

- **μ—¬λ¬ κ°μ λ§μ΄ν¬λ΅μ„λΉ„μ¤(API)λ¥Ό μ΄μν•  λ•**
- **ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¨μΌ μ—”λ“ν¬μΈνΈ(API Gateway)λ§ μ‚¬μ©ν•λ„λ΅ λ§λ“¤κ³  μ‹¶μ„ λ•**
- **JWT μΈμ¦, μ†λ„ μ ν•, μ”μ²­ λ³€ν™ λ“±μ κΈ°λ¥μ΄ ν•„μ”ν•  λ•**

### π“ μμ 

#### π”Ή **API Gateway μ—†μ΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ”μ²­ν•λ” κ²½μ°**

```
ν΄λΌμ΄μ–ΈνΈ β†’ UserService(5001)
ν΄λΌμ΄μ–ΈνΈ β†’ OrderService(5002)
```

β΅οΈ ν΄λΌμ΄μ–ΈνΈκ°€ κ° μ„λΉ„μ¤μ μ£Όμ†λ¥Ό μ•μ•„μ•Ό ν•λ©°, λ³΄μ• λ° μΈμ¦μ΄ μ–΄λ ¤μ›€.

#### π”Ή **API Gatewayλ¥Ό μ‚¬μ©ν•μ—¬ μ¤‘μ•™μ—μ„ μ”μ²­μ„ κ΄€λ¦¬ν•λ” κ²½μ°**

```
ν΄λΌμ΄μ–ΈνΈ μ”μ²­ β†’ API Gateway β†’ μ μ ν• λ§μ΄ν¬λ΅μ„λΉ„μ¤(UserService, OrderService λ“±)λ΅ μ „λ‹¬
```

β΅οΈ ν΄λΌμ΄μ–ΈνΈλ” API Gateway ν•λ‚λ§ νΈμ¶ν•λ©΄ λκ³ , λ‚΄λ¶€μ μΌλ΅ λΌμ°ν…μ΄ μν–‰λ¨.

#### π”Ή **Ocelotμ„ μ‚¬μ©ν• API Gateway μμ ** (`ocelot.json`)

```json
{
  "Routes": [
    {
      "UpstreamPathTemplate": "/users/{everything}",
      "DownstreamPathTemplate": "/api/user/{everything}",
      "DownstreamScheme": "http",
      "DownstreamHostAndPorts": [{ "Host": "userservice", "Port": 5001 }],
      "AuthenticationOptions": {
        "AuthenticationProviderKey": "Bearer"
      }
    }
  ],
  "GlobalConfiguration": {
    "BaseUrl": "https://myapigateway.com"
  }
}
```

β΅οΈ ν΄λΌμ΄μ–ΈνΈκ°€ `https://myapigateway.com/users/...` μ”μ²­μ„ λ³΄λ‚΄λ©΄ API Gatewayκ°€ `UserService(5001λ² ν¬νΈ)`λ΅ μ”μ²­μ„ μ „λ‹¬.
β΅οΈ API Gatewayμ—μ„ **JWT μΈμ¦μ„ κ²€μ¦ν• ν›„** μ„λΉ„μ¤μ— μ”μ²­μ„ λ³΄λƒ„.

---

## Reverse Proxy vs API Gateway λΉ„κµ

| λΉ„κµ ν•­λ©       | **Reverse Proxy**                         | **API Gateway**                       |
| --------------- | ----------------------------------------- | ------------------------------------- |
| **μ£Όμ” μ—­ν• **   | λ™μΌν• μ„λΉ„μ¤μ μ—¬λ¬ μ„λ²„μ— νΈλν”½μ„ λ¶„μ‚° | λ‹¤μ–‘ν• λ§μ΄ν¬λ΅μ„λΉ„μ¤λ΅ μ”μ²­μ„ λΌμ°ν… |
| **λ³΄μ• κΈ°λ¥**   | κΈ°λ³Έ μ κ³µ μ—†μ (λ―Έλ“¤μ›¨μ–΄ ν•„μ”)            | JWT, OAuth 2.0 μΈμ¦ μ§€μ›              |
| **λ΅λ“ λ°Έλ°μ‹±** | μ§€μ› (Round Robin λ“±)                     | μΌλ¶€ μ§€μ› (νΉμ • API λ΅λ“ λ°Έλ°μ‹± κ°€λ¥) |
| **μ”μ²­ λ³€ν™**   | μΌλ°μ μΌλ΅ μ—†μ                           | λ°μ΄ν„° λ³€ν™, ν—¤λ” μμ • κ°€λ¥           |
| **μ†λ„ μ ν•**   | κΈ°λ³Έμ μΌλ΅ μ—†μ                           | API μ”μ²­ μ μ ν• κ°€λ¥ (Rate Limiting) |
| **μ‚¬μ© λ©μ **   | μ„±λ¥ μµμ ν™” λ° νΈλν”½ κ΄€λ¦¬                | API λ³΄μ• λ° λ§μ΄ν¬λ΅μ„λΉ„μ¤ κ΄€λ¦¬       |

---

## κ²°λ΅ 

β” **Reverse Proxyλ” λ™μΌν• μ„λΉ„μ¤λ¥Ό μ—¬λ¬ κ° μ΄μν•  λ•, μ”μ²­μ„ λ¶€ν• λ¶„μ‚°ν•΄μ•Ό ν•λ” κ²½μ°μ— μ‚¬μ©**  
β” **API Gatewayλ” λ‹¤μ–‘ν• λ§μ΄ν¬λ΅μ„λΉ„μ¤λ¥Ό μ΄μν•  λ•, μ”μ²­μ„ μ μ ν• μ„λΉ„μ¤λ΅ λΌμ°ν…ν•κ³  μΈμ¦μ„ μ μ©ν•΄μ•Ό ν•λ” κ²½μ°μ— μ‚¬μ©**  
β” **Reverse Proxy(YARP)μ™€ API Gateway(Ocelot)λ¥Ό ν•¨κ» μ‚¬μ©ν•μ—¬ API Gateway + λ΅λ“ λ°Έλ°μ‹±μ„ μµμ ν™”ν•  μλ„ μμ**
